# 技术架构（暂定）

> 范围：描述当前阶段的“可复用骨架”。具体功能差异由各 PRD 自己补充。

## 1. 总体目标

- Web 形态（React）优先，支持持续迭代
- 在线服务快响应；离线计算可重试/可扩展
- 为后续“策略/建议”预留：可插拔的计算任务与规则体系

## 2. MVP 推荐组件（单机 Docker Compose）

- `frontend`：React（展示告警、配置 watchlist/规则、查看详情）
- `api`：FastAPI（配置/查询/鉴权/触发任务）
- `redis`：Celery broker（任务队列）
- `worker`：Celery workers（拉取数据、计算、生成告警、推送、写库）
- `beat`：Celery Beat（每 15 分钟投递扫描任务）
- `postgres`：配置与结果存储（watchlist、规则、告警历史、去重状态）

## 3. 关键原则

- 不在 API 请求链路里做高 CPU 计算（计算下沉到 worker）
- 任务需要幂等（尤其是“按规则维度只推送一次”的去重）
- 可观测性最小集：任务开始/结束、失败原因、最后成功扫描时间
- 注重单元测试， 关键方法都要测试，在 plan 阶段能有test case设计

## 4. 后续演进（非 MVP）

- 任务量/并发上来：增加 worker、副本扩容
- 多用户/公网访问：完善鉴权、密钥管理、审计与安全策略
- 复杂数据管道：引入更强的 workflow/调度（如 Prefect/Airflow）或迁移到 k8s

